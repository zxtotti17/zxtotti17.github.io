{"title":"Alchemist_manage服务器部署","uid":"6e1762f4087a3c7b84bbdf912ec8c60e","slug":"alchemist-manage服务器部署","date":"2018-07-11T08:55:25.000Z","updated":"2021-11-30T09:01:28.345Z","comments":true,"path":"api/articles/alchemist-manage服务器部署.json","keywords":"node.js blogs IT 互联网 服务端 游戏 mysql redis","cover":[],"content":"<ol>\n<li>manage服务器代码上传<br>copy srpg_too 目录到 /var/webapps/alchemist_mnt    (文件所有者必须为webapp)</li>\n<li>ruby运行环境构建</li>\n<li>1 检查依赖</li>\n</ol>\n<p>-ruby(v2.2.2p95~)<br>-gem bundle<br>-Node.js<br>-npm<br>-bower<br>-msyql<br>-redis<br>2.1 设置gem源为淘宝源<br>Gemfile （描述gem之间依赖文件）需要如下修改<br>source ‘<a href=\"https://gems.ruby-china.org/&#39;\">https://gems.ruby-china.org/&#39;</a><br>2.2  安装gem file<br>su  - webapp<br>bundle install<br>2.2.1 安装bundle 命令不存在，。<br>gem install bundle<br>2.2.2 提示gem命令不存在，就执行rbenv global 2.2.2， 如果无法运行就重新安装ruby 2.2.2 版本，流程如下<br>su - webapp<br>git clone <a href=\"https://github.com/rbenv/rbenv.git\">https://github.com/rbenv/rbenv.git</a> ~/.rbenv<br>cd ~/.rbenv &amp;&amp; src/configure &amp;&amp; make -C src<br>echo ‘export PATH=”$HOME/.rbenv/bin:$PATH”‘ &gt;&gt; ~/.bash_profile<br>~/.rbenv/bin/rbenv init<br>echo ‘eval “$(rbenv init -)”‘ &gt;&gt; ~/.bash_profile<br>source ~/.bash_profile<br>git clone <a href=\"https://github.com/rbenv/ruby-build.git\">https://github.com/rbenv/ruby-build.git</a> ~/.rbenv/plugins/ruby-build<br>rbenv install 2.2.2<br>rbenv global 2.2.2<br>ruby -v</p>\n<span id=\"more\"></span>\n<ol start=\"3\">\n<li>Cap环境部署</li>\n<li>1 配置SSH无密码登录<br>配置config/deploy/produciton.rb ssh无密码登陆（id_rsa.pub和authorized_keys） 设置authorized_keys，记得chmod 600，否则无法生效）</li>\n<li>1.1 生成sshkey:<br>cd ~/.ssh<br>ssh-keygen<br>输入公钥名：id_rsa<br><img src=\"/post/AADD68F1E0BFC2CE65796C5F7EEBD67E.jpg\" alt=\"AADD68F1E0BFC2CE65796C5F7EEBD67E\"></li>\n<li>1.2 配置authorized_keys<br>cat  id_rsa.pub &gt;&gt; authorized_keys<br>chmod -R 600 authorized_keys<br>chmod 700 <del>/.ssh<br>备注：如果还是无法实现无密码登录，再清空下</del>/.ssh/koown_hosts文件（echo “” &gt; ~/.sshown_hosts);<br><img src=\"/post/AADD68F1E0BFC2CE65796C5F7EEBD67E.jpg\" alt=\"AADD68F1E0BFC2CE65796C5F7EEBD67E\"></li>\n<li>1.3执行以下deploy命令：production环境为例<br>cd current<br>bundle exec cap production mkdir:sockets<br>bundle exec cap production bower:install</li>\n<li>前端bower模块安装</li>\n<li>1 Node.js 安装bower<br>npm install -g bower –registry=<a href=\"https://registry.npm.taobao.org\">https://registry.npm.taobao.org</a>   (-g不一定要)</li>\n<li>2install Bowerfile<pre><code>bundle exec rake bower:install</code></pre></li>\n<li>3 manage server DB构建<br>bundle exec rake maint:create maint:migrate</li>\n</ol>\n<p>4.4 添加管理账号<br>  bundle exec rake maint:seed</p>\n<p>4.5  配置crontab<br>    缺少crontab 会影响预约奖励发放<br>    cd 根目录（current/）<br>    gem install whenever ，检查config/schedule.rb是否存在<br>    whenever -w（写入到crontab 中）<br>    查看log/cron_log.log日志是否已生成。</p>\n","text":" manage服务器代码上传copy srpg_too 目录到 /var/webapps/alchemist_mnt (文件所有者必须为webapp) ruby运行环境构建 1 检查依赖 -ruby(v2.2.2p95~)-gem bundle-Node.js-npm-bower...","link":"","photos":[],"count_time":{"symbolsCount":"1.7k","symbolsTime":"2 mins."},"categories":[{"name":"脚本工具","slug":"脚本工具","count":3,"path":"api/categories/脚本工具.json"}],"tags":[{"name":"Ruby on Rails","slug":"Ruby-on-Rails","count":1,"path":"api/tags/Ruby-on-Rails.json"},{"name":"Capistrano 自动部署工具","slug":"Capistrano-自动部署工具","count":1,"path":"api/tags/Capistrano-自动部署工具.json"}],"toc":"","author":{"name":"Fly","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一个在夏天会被芒果砸到的城市靠写代码为生的前职业电竞选手","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"ALC_Sentry","uid":"325a758ec467f97d0caf0311703869d6","slug":"ALC-Sentry","date":"2018-07-24T08:06:55.000Z","updated":"2019-11-27T15:26:48.000Z","comments":true,"path":"api/articles/ALC-Sentry.json","keywords":"node.js blogs IT 互联网 服务端 游戏 mysql redis","cover":[],"text":"1) 安装环境执行命令创建名为sentry的数据库createdb -E utf-8 sentry为sentry项目初始化数据sentry –config=/.sentry/sentry.conf.py upgrade创建新用户sentry –config=/.sentry/se...","link":"","photos":[],"count_time":{"symbolsCount":792,"symbolsTime":"1 mins."},"categories":[{"name":"开发环境安装","slug":"开发环境安装","count":2,"path":"api/categories/开发环境安装.json"}],"tags":[{"name":"Sentry","slug":"Sentry","count":1,"path":"api/tags/Sentry.json"}],"author":{"name":"Fly","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一个在夏天会被芒果砸到的城市靠写代码为生的前职业电竞选手","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{}}