{"title":"游戏全局通知红点系统","uid":"c3f4727b2c3a19f39df59e9531fb513f","slug":"游戏全局通知红点系统","date":"2019-08-23T09:44:00.000Z","updated":"2021-11-30T09:00:43.135Z","comments":true,"path":"api/articles/游戏全局通知红点系统.json","keywords":"node.js blogs IT 互联网 服务端 游戏 mysql redis","cover":[],"content":"<p>红点功能贯穿游戏所有功能，像是一个全局的通知，用一个配置表记录所有游戏功能及入口和红点、开启的方法名加载进内存<br><img src=\"/post/Red15669620461084.png\" alt=\"Red15669620461084\"><br>主入口界面时候调用<br>取得已开启的功能列表mod_function:get_all_game_function() 构造成带父子关系的功能列表</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">&#123;Id,[&#123;GameFunction #game_function.id&#125;|List1]&#125;\n|\nlists:delete(&#123;Id,List1&#125;,L)</code></pre>\n<p>通过核心回调到所有模块的红点方法</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">IsRed &#x3D; if\n    Mod &#x3D;&#x2F;&#x3D; &#39;&#39;, Func &#x3D;&#x2F;&#x3D; &#39;&#39; -&gt;\n        try erlang:apply(Mod,Func,[PlayerId]) of\n            Result -&gt;\n                Result\n        catch\n            _ : _ -&gt;\n                false\n        end;\n    true -&gt;\n        false\nend,</code></pre>\n<p>最后将缓存中的玩家红点数据替换</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">lib_ets:delete(player_red, PlayerId),\n    lib_ets:insert(\n        player_red,\n        #player_red&#123;\n            player_id &#x3D; PlayerId,\n            red_list  &#x3D; N\n        &#125;,\n        replace\n    ),</code></pre>\n\n<p>不同的功能触发红点改变需要有个打点的函数,在功能需要改变红点状态的时候通知进来更新缓存</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">notify_game_function_is_red (PlayerId,FunctionId) -&gt;\n    case mod_function:check_lock(PlayerId,FunctionId) of\n        false -&gt;\n            noop;\n        _ -&gt;\n            GameFunction &#x3D; code_db:get(game_function,[FunctionId]),\n            Mod   &#x3D; list_to_atom(GameFunction #game_function.red_mod),\n            Func  &#x3D; list_to_atom(GameFunction #game_function.red_func),\n            IsRed &#x3D; if\n                Mod &#x3D;&#x2F;&#x3D; &#39;&#39;, Func &#x3D;&#x2F;&#x3D; &#39;&#39; -&gt;\n                   try erlang:apply(Mod,Func,[PlayerId]) of\n                        Result -&gt;\n                            Result\n                    catch\n                        _ : _ -&gt;\n                            false\n                    end;\n                true -&gt;\n                    false\n            end,\n            if\n                GameFunction #game_function.relation &gt; 0 -&gt;\n                    notify_relation_game_function_is_red(PlayerId,GameFunction #game_function.relation,FunctionId,IsRed);%通知父类联动的函数\n                true -&gt;\n                    update_game_function_cache(PlayerId,FunctionId,IsRed)\n            end\n    end.</code></pre>","text":"红点功能贯穿游戏所有功能，像是一个全局的通知，用一个配置表记录所有游戏功能及入口和红点、开启的方法名加载进内存主入口界面时候调用取得已开启的功能列表mod_function:get_all_game_function() 构造成带父子关系的功能列表 &#123;Id,[&#123...","link":"","photos":[],"count_time":{"symbolsCount":"2k","symbolsTime":"2 mins."},"categories":[{"name":"设计方法","slug":"设计方法","count":5,"path":"api/categories/设计方法.json"}],"tags":[{"name":"游戏","slug":"游戏","count":8,"path":"api/tags/游戏.json"}],"toc":"","author":{"name":"Fly","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一个在夏天会被芒果砸到的城市靠写代码为生的前职业电竞选手","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"游戏中的运营活动框架思路","uid":"e88abce89c8aca44a71f313b7a0268e8","slug":"游戏中的运营活动框架和思路","date":"2019-11-22T08:15:07.000Z","updated":"2021-11-30T09:01:00.273Z","comments":true,"path":"api/articles/游戏中的运营活动框架和思路.json","keywords":"node.js blogs IT 互联网 服务端 游戏 mysql redis","cover":[],"text":"游戏的运营活动一般会有好多种类型，但是这些类型的功能一般是有共同和非共同的部分，这里记录一个对多类型运营活动的管理框架通过模板表录入运营活动的参数，包括跳转模块，开启方法，红点方法，等级等。如果有类似活动结束发奖的奖励表也可以用表来记录不同活动operation_id对应的奖励进...","link":"","photos":[],"count_time":{"symbolsCount":"5.2k","symbolsTime":"5 mins."},"categories":[{"name":"设计方法","slug":"设计方法","count":5,"path":"api/categories/设计方法.json"}],"tags":[{"name":"游戏","slug":"游戏","count":8,"path":"api/tags/游戏.json"}],"author":{"name":"Fly","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一个在夏天会被芒果砸到的城市靠写代码为生的前职业电竞选手","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Redis笔记","uid":"cf4d6c3460b72521408e1365a505bd53","slug":"redis笔记","date":"2019-08-01T08:52:31.000Z","updated":"2021-11-30T09:05:53.076Z","comments":true,"path":"api/articles/redis笔记.json","keywords":"node.js blogs IT 互联网 服务端 游戏 mysql redis","cover":null,"text":" Redis是什么、特点、优势redis是Key-Value数据库,数据包含各种数据 字符串String、字典Hash、列表List、集合Set、有序集合SortedSet等redis支持数据持久化，重启再次加载,支持数据备份(支持分布式),Redis是单进程单线程的Redis的...","link":"","photos":[],"count_time":{"symbolsCount":"6k","symbolsTime":"5 mins."},"categories":[{"name":"IT笔记","slug":"IT笔记","count":21,"path":"api/categories/IT笔记.json"}],"tags":[{"name":"redis","slug":"redis","count":2,"path":"api/tags/redis.json"}],"author":{"name":"Fly","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"一个在夏天会被芒果砸到的城市靠写代码为生的前职业电竞选手","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}